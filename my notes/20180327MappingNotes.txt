omh:step-count:1.0 ---> Observation Profile

{
    "$schema": "http://json-schema.org/draft-04/schema#",  ---> fixed value, not mapped

    "description": "This schema represents a single measurement of number of steps.
    The ability to represent descriptive statistics (e.g., mean, median) will be added shortly. ", --> StructureDefintion.definition and /or  ElementDefinition.definition

    "type": "object",  ----> StructureDefinition  ( FHIR Profile on Observation )
    "references": [
        {
            "description": "The LOINC code refers to Number of steps in unspecified time Pedometer",  ----> ElementDefinition.comment  or (mapping to ontology)
            "url": "http://purl.bioontology.org/ontology/LNC/55423-8"
        }
    ],

    "definitions": {
        "time_frame": {
            "$ref": "time-frame-1.x.json" ---> one of dateTime, Period, Timing datatype

    },

    "properties": {
        "step_count": {   ----------------------->  Observation.code
            "type": "number"  ------------------------> Observation.valueQuantity
        },
        "effective_time_frame": {
            "$ref": "#/definitions/time_frame" ---> Observation.effective[x]( one of effectivedateTime, effectivePeriod, effectiveTiming )
        }
    },

    "required": ["step_count"]  --> ElementDefinition.min (Minimum Cardinality)
}



example

{
    "step_count": 6000
}



Finnish PHR Steps Taken profile
https://simplifier.net/FinnishPHR/fiphr-stepstaken-stu3/~json


{
  "resourceType": "StructureDefinition",
  "id": "fiphr-sd-stepstaken-stu3",
  "meta": {
    "lastUpdated": "2018-03-16T09:55:36.591+02:00"
  },
  "url": "http://phr.kanta.fi/StructureDefinition/fiphr-stepstaken-stu3",
  "version": "1.0",
  "name": "fiphr-sd-stepstaken-stu3",
  "title": "Finnish PHR Steps Taken profile",
  "status": "active",
  "experimental": false,
  "date": "2018-03-16",
  "publisher": "W2E",
  "description": "Finnish PHR profile for fitness device measurement or patient-reported steps taken over a time period. The profile is based on the Finnish PHR Fitness profile.",
  "fhirVersion": "3.0.1",
  "kind": "resource",
  "abstract": false,
  "type": "Observation",
  "baseDefinition": "http://phr.kanta.fi/StructureDefinition/fiphr-fitness-stu3",
  "derivation": "constraint",

  "differential": {
    "element": [
      {
        "id": "Observation",
        "path": "Observation",
        "short": "Finnish PHR Steps-Taken profile",
        "definition": "The PHR Steps-Taken profile is used to store step count observations of a patient over various measurement periods."
      },
      {
        "id": "Observation.meta.profile",
        "path": "Observation.meta.profile",
        "fixedUri": "http://phr.kanta.fi/StructureDefinition/fiphr-stepstaken-stu3"
      },
      {
        "id": "Observation.extension:creatingApplication",
        "path": "Observation.extension",
        "sliceName": "creatingApplication"
      },
      {
        "id": "Observation.extension:creatingApplication.url",
        "path": "Observation.extension.url",
        "fixedUri": "http://phr.kanta.fi/StructureDefinition/fiphr-ext-creatingapplication"
      },
      {
        "id": "Observation.code.coding",
        "path": "Observation.code.coding",
        "slicing": {
          "discriminator": [
            {
              "type": "value",
              "path": "code"
            }
          ],
          "rules": "closed"
        }
      },
      {
        "id": "Observation.code.coding:steps",
        "path": "Observation.code.coding",
        "sliceName": "steps",
        "short": "Observation of steps taken over an arbitrary period",
        "definition": "Measured steps during an arbitrary reported period.",
        "min": 1,
        "max": "1"
      },
      {
        "id": "Observation.code.coding:steps.system",
        "path": "Observation.code.coding.system",
        "fixedUri": "http://loinc.org"
      },
      {
        "id": "Observation.code.coding:steps.code",
        "path": "Observation.code.coding.code",
        "fixedCode": "66334-4"
      },
      {
        "id": "Observation.code.coding:dailySteps",
        "path": "Observation.code.coding",
        "sliceName": "dailySteps",
        "short": "Observation of steps taken in 24h",
        "definition": "Measured steps during a 24 hour period; use dateTime with 8 characters to mark the date of observation data.",
        "max": "1"
      },
      {
        "id": "Observation.code.coding:dailySteps.system",
        "path": "Observation.code.coding.system",
        "fixedUri": "http://loinc.org"
      },
      {
        "id": "Observation.code.coding:dailySteps.code",
        "path": "Observation.code.coding.code",
        "fixedCode": "41950-7"
      },
      {
        "id": "Observation.code.coding:weeklySteps",
        "path": "Observation.code.coding",
        "sliceName": "weeklySteps",
        "short": "Observation of steps taken in a week",
        "definition": "Measured steps during a week; use period startdate-enddate to mark the observation week.",
        "max": "1"
      },
      {
        "id": "Observation.code.coding:weeklySteps.system",
        "path": "Observation.code.coding.system",
        "fixedUri": "http://loinc.org"
      },
      {
        "id": "Observation.code.coding:weeklySteps.code",
        "path": "Observation.code.coding.code",
        "fixedCode": "41952-3"
      },
      {
        "id": "Observation.value[x]",
        "path": "Observation.valueQuantity",
        "definition": "Finnish PHR: Steps taken as integer",
        "min": 1,
        "type": [
          {
            "code": "Quantity"
          }
        ]
      },
      {
        "id": "valueQuantity:valueQuantity.value",
        "path": "Observation.valueQuantity.value",
        "min": 1
      },
      {
        "id": "valueQuantity:valueQuantity.comparator",
        "path": "Observation.valueQuantity.comparator",
        "max": "0"
      },
      {
        "id": "valueQuantity:valueQuantity.unit",
        "extension": [
          {
            "url": "http://hl7.org/fhir/StructureDefinition/elementdefinition-translatable",
            "valueBoolean": true
          }
        ],
        "path": "Observation.valueQuantity.unit",
        "min": 1,
        "fixedString": "1"
      },
      {
        "id": "valueQuantity:valueQuantity.system",
        "path": "Observation.valueQuantity.system",
        "min": 1,
        "fixedUri": "http://unitsofmeasure.org"
      },
      {
        "id": "valueQuantity:valueQuantity.code",
        "path": "Observation.valueQuantity.code",
        "min": 1,
        "fixedCode": "1"
      },
      {
        "id": "Observation.component",
        "path": "Observation.component",
        "max": "0"
      }
    ]
  }
}

Example:

{
	"resourceType": "Observation",
	"id": "steps-example",
	"meta": {
		"versionId": "ec92eda3-b6e9-4c66-9546-1ab41689a0cf",
		"lastUpdated": "2018-03-28T01:54:13.793+00:00",
		"profile": [
			"http://phr.kanta.fi/StructureDefinition/fiphr-stepstaken-stu3"
		]
	},
	"status": "final",
	"category": [
		{
			"coding": [
				{
					"system": "http://hl7.org/fhir/observation-category",
					"code": "activity",
					"display": "Activity"
				}
			]
		}
	],
	"code": {
		"coding": [
			{
				"system": "http://loinc.org",
				"code": "66334-4",
				"display": "Steps taken"
			}, {
				"system": "http://loinc.org",
				"code": "55423-8",
				"display": "Number of steps in unspecified time Pedometer"
			}
		],
		"text": "Step count"
	},
	"subject": {
		"reference": "http://vonk.fire.ly/Patient/example"
	},
	"effectiveDateTime": "2018-03-28",
	"issued": "2018-03-28T01:27:55+00:00",
	"performer": [
		{
			"reference": "http://vonk.fire.ly/Patient/example"
		}
	],
	"valueQuantity": {
		"value": 6000,
		"unit": "1",
		"system": "http://unitsofmeasure.org",
		"code": "1"
	}
}


Identity resolution...



mappings


At high level where can mappings occur...

Shimmer level direct from source

after shimmer from omh schema

(see pictures)

## Primitive Datatypes Mappiong

These map 1:1 which is illustrated using date-time...

"2013-02-05T07:25:00+03:00"

*OMH*
~~~
{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "description": "This schema represents a point in time (ISO8601). If a timezone is not included, the timezone is assumed to be UTC.",
    "type": "string",
    "references": [
        {
            "description": "Reference RFC 3339 5.6 for details.",
            "url": "http://tools.ietf.org/html/rfc3339#section-5.6"
        },
        {
            "description": "The SNOMED codes represent Single point in time (qualifier value).",
            "url": "http://purl.bioontology.org/ontology/SNOMEDCT/123029007"
        }
    ],
    "format": "date-time"
}


~~~

*FHIR*

dateTime	A date, date-time or partial date (e.g. just year or year + month) as used in human communication. The format is YYYY, YYYY-MM, YYYY-MM-DD or YYYY-MM-DDThh:mm:ss+zz:zz, e.g. 2018, 1973-06, 1905-08-23, 2015-02-07T13:28:17-05:00 or 2017-01-01T00:00:00.000Z. If hours and minutes are specified, a time zone SHALL be populated. Seconds must be provided due to schema type constraints but may be zero-filled and may be ignored. Dates SHALL be valid dates. The time "24:00" is not allowed. Leap Seconds are allowed - see below

A JSON string - a union of xs:dateTime, xs:date, xs:gYearMonth, xs:gYear
Regex: ([0-9]([0-9]([0-9][1-9]|[1-9]0)|[1-9]00)|[1-9]000)(-(0[1-9]|1[0-2])(-(0[1-9]|[1-2][0-9]|3[0-1])(T([01][0-9]|2[0-3]):[0-5][0-9]:([0-5][0-9]|60)(\.[0-9]+)?(Z|(\+|-)((0[0-9]|1[0-3]):[0-5][0-9]|14:00)))?)?)?


## Complex Datatypes mapping

### Illustrate this using date-time



~~~

{
    "$schema": "http://json-schema.org/draft-04/schema#",

    "description": "This schema describes an interval of time. In the absence of a precise start and/or end time, the time interval can be described as a date + a part of the day (morning, afternoon, evening, night). No commitments are made as to whether the start or end time point itself is included in the interval (i.e., whether the defined interval includes the boundary point(s) or not).",
    "type": "object",

    "references": [
        {
            "description": "The NCIT codes represent Timespan (synonym: time interval).",
            "url": "https://ncim.nci.nih.gov/ncimbrowser/ConceptReport.jsp?dictionary=NCI%20MetaThesaurus&code=C0872291"
        }
    ],

    "definitions": {
        "date_time": {
            "$ref": "date-time-1.x.json"
        },
        "duration-unit-value": {
            "$ref": "duration-unit-value-1.x.json"
        },
        "full_date": {
            "type": "string",
            "references": [
                {
                    "description": "This schema represents a date. See RFC 3339 5.6 for details.",
                    "url": "http://tools.ietf.org/html/rfc3339"
                }
            ],
            "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}$"
        },
        "part_of_day": {
            "$ref": "part-of-day-1.x.json"
        }
    },

    "oneOf": [
        {
            "properties": {
                "start_date_time": {
                    "$ref": "#/definitions/date_time"
                },
                "duration": {
                    "$ref": "#/definitions/duration-unit-value"
                }
            },
            "required": ["start_date_time", "duration"]
        },
        {
            "properties": {
                "end_date_time": {
                    "$ref": "#/definitions/date_time"
                },
                "duration": {
                    "$ref": "#/definitions/duration-unit-value"
                }
            },
            "required": ["end_date_time", "duration"]
        },
        {
            "properties": {
                "start_date_time": {
                    "$ref": "#/definitions/date_time"
                },
                "end_date_time": {
                    "$ref": "#/definitions/date_time"
                }
            },
            "required": ["start_date_time", "end_date_time"]
        },
        {
            "properties": {
                "date": {
                    "$ref": "#/definitions/full_date"
                },
                "part_of_day": {
                    "$ref": "#/definitions/part_of_day"
                }
            },
            "required": ["date", "part_of_day"]
        }
    ]
}

~~~
